<template>
    <div>
        <div class="Package" > 
            <div class="packageTop"> {{RoomTitle}}
            <Button @click="closeRoom" style="float:right;border: none;background: #fff; width: 40px;cursor: pointer;outline: none;"> <Icon type="close"></Icon></Button>
            </div>
            <div class="SetMeal" style="margin-top:15px;"> 
                <div class="InputList">
                    <div>
                    <label for="">房间名称</label>
                    <Input style="width: 70%" v-model="hotelRoom.roomName"></Input>
                    </div>
                    <div>
                    <label for="">建筑面积(m²)</label>
                    <Input style="width: 70%" v-model="hotelRoom.floorArea"></Input>
                    </div>
                </div>      
                <div class="InputList">
                    <div>
                    <label for="">床型</label>
                    <Select v-model="hotelRoom.bedType"  style="width: 70%">
                        <Option  key="0" value="SINGLE">单人床</Option>
                        <Option  key="1" value="DOUBLE">双人床</Option>
                        <Option  key="2" value="FAMILY">家庭床</Option>
                    </Select>
                    </div>
                    <div>
                    <label for="">最大入驻人数</label>
                    <Input style="width: 70%" v-model="hotelRoom.peopleNum"></Input>
                    </div>
                </div>
        
                <div class="InputList" >
                    <div>
                    <label for="">默认库存</label>
                    <Input v-model="hotelRoom.defaultRepertory"  style="width: 70%"></Input>
                    </div>
                    <div>
                    <label for="">房间详情</label>
                    <Input style="width: 70%" v-model="hotelRoom.detail"></Input>
                    </div>
                </div>
                <div class="InputList">
                    <div>
                        <label for="">床号</label>
                        <Select v-model="hotelRoom.bedSize"  style="width: 70%">
                            <Option  key="0" value="0">1.8m</Option>
                            <Option  key="1" value="1">2.0m</Option>
                        </Select>
                    </div>
                    <div>
                    </div>
                </div>
                <div style="text-align:center;padding:5px 0;margin-top:15px;"> 
                    <Button type="success" @click="subRoom"> 下一步</Button>
                </div>
            
            <div style="padding:20px 0 0 10px;background:#fff;"> 
            <h3>房间图片 </h3>

            <div v-for="(list,index) of imglist" :key="index" class="imglist demo-upload-list"> 
                <img :src="smallImg(index)" style="width:100px">
                <div class="demo-upload-list-cover"> 
                    <Icon type="ios-eye-outline" @click.native="handleView(index)"></Icon>
                    <Icon type="ios-trash-outline" @click.native="handleRemove(index)"></Icon>
                </div>
            </div>
            <Upload  style="display:inline-block" :before-upload="handleUpload" :show-upload-list="false" action="//jsonplaceholder.typicode.com/posts/">
                <img src="../../../assets/a11.png" style="width:100px;">
            </Upload>  

            <h3>库存设置 </h3>
            <div style="display: flex;width:100%;">
                
                <div style="width:410px;">
                <!-- <Calendar ref="Calendar" :markDateMore="arr" v-on:isToday="clickToday" v-on:choseDay="clickDay" v-on:changeMonth="changeDate"></Calendar> -->
                </div>
                <div style="padding-left:20px;">
                <p>{{time}}</p>库存：
                    <Input v-model="repertoryNums" style="width: 150px;"></Input>
                    <!-- <Button type="success" @click="subRepertory">确定</Button> -->
                    <div>
                    <p v-for="item in shuju" :value="item" :key="item">{{item}}</p>
                    </div>
                </div>
            </div>
            </div>
            </div>
        </div>
    </div>
</template>
<script>
import Calendar from '../vue-calendar-component/index.js';
export default {
    components: {
      Calendar
    },
    props: {
        roomDetails: Object
    },
    data() {
        return {
           RoomShow: true,
           RoomTitle: "编辑房间",
           time: "",
           repertoryNums: "0",
           shuju: [],
           hotelRoomId: "",
           imglist: [],
           imglistId: [],
           Imgurl: [],
           hotelRoom: {
                roomName: "",
                floorArea: "",	
                bedType: "",
                peopleNum: "",
                defaultRepertory: "",	
                detail: "",
                bedSize: ""
            },  
           amplification: "",
        }
    },
    watch: {
        roomDetails: function(val){
            console.log(this.roomDetails)
            let {
                roomName,
                floorArea,	
                bedType,
                peopleNum,
                defaultRepertory,	
                detail,
                hotelRoomId,
                bedSize
            } = this.roomDetails;

            this.hotelRoom.roomName = roomName;
            this.hotelRoom.floorArea = floorArea;
            this.hotelRoom.bedType = bedType;
            this.hotelRoom.peopleNum = peopleNum;
            this.hotelRoom.defaultRepertory = defaultRepertory;
            this.hotelRoom.detail = detail;
            this.hotelRoom.bedSize = bedSize;
            
            this.hotelRoomId = hotelRoomId;
            this.time = "";
            this.shuju = [];
            this.repertoryNums = "0";
            let pictureList = this.roomDetails.hotelRoomPictures;
            this.imglist = [];
            this.imglistId = [];
            this.Imgurl = [];
            for (let i of pictureList) {

                this.imglist.push({ url: i.pictureUrl });
                this.imglistId.push({ id: i.hotelRoomPictureId });
                this.Imgurl.push({ url: "" });
            }
            console.log(pictureList);
        }
    },
    methods: {
        closeRoom() {
            this.$emit("close", true);
        },
        // 编辑提交
        subRoom() {
            let url = "";
            let data = this.hotelRoom;
                url = `${this.AjaxUrl}/ty_manage/hotel/room/update`;
                data.hotelRoomId = this.hotelRoomId;
            for (let key in this.hotelRoom) {
                if (this.hotelRoom[key] == "") {
                    this.error("所有内容都必须填写!");
                    return false;
                }
                }
            data.hotelId = this.roomDetails.hotelId;
            this.axios
                .post(url,this.qs.stringify(data))
                .then(res => {
                if(res.errorCode == 200){
                    this.success(res.message);
                    // this.HotelRoomList();
                }else if(res.errorCode == 303){
                    this.error(res.message);
                }else{
                    this.error(res.message);
                }
                
                })
                .catch(err => {
                console.log(err);
                });
        },
        //上传房间图片
        handleUpload(file) {
        var reader = new FileReader();
        var _this = this;
        let data = new FormData();
        data.append("sort", this.imglist.length);
        data.append("hotelId", this.roomDetails.hotelId);
        data.append("hotelRoomId", this.hotelRoomId);
        data.append("hotelRoomPicture", file);
        this.axios
            .post(`${this.AjaxUrl}/ty_manage/hotel/room/picture/upload`,data)
            .then(res => {
            if (res.errorCode == 200) {
                this.imglist.push({ url: res.data });
                reader.readAsDataURL(file);
                reader.onload = function(e) {
                _this.Imgurl.push({ url: this.result });
                };
                // this.checkHotelRoom();
            }else{
                this.error(res.message);
            }
            })
            .catch(err => {
            console.log(err);
            });
        },
        smallImg(index) {
        if(this.Imgurl[index].url != "") {
            return this.Imgurl[index].url;
        }else {
            return this.imgUrl + this.imglist[index].url + "_small.jpg";
        }
        },
        //图片放大
        handleView(index) {
        this.visible = true;
        if(this.Imgurl[index].url != "") {
            this.amplification = this.Imgurl[index].url;
        }else {
            this.amplification = this.imgUrl + this.imglist[index].url + "_small.jpg";
        }
        },

        //图片删除
        handleRemove(index) {
        let data = {};
        data.hotelRoomPictureId	 = this.imglistId[index].id;
        this.axios
            .post(
            `${this.AjaxUrl}/ty_manage/hotel/room/picture/delete`,
            this.qs.stringify(data)
            )
            .then(res => {
            if (res.errorCode == 200) {
                console.log(res.message);
                this.imglist.splice(index,1);
                this.Imgurl.splice(index,1);
            }else{
                this.error(res.message);
            }
            })
            .catch(err => {});
        },
        error(text) {
            this.$Message.error(text);
        },
        success(text) {
            this.$Message.success(text);
        },
    }
}
</script>
<style>
.Package {
  position: absolute;
  height: 600px;
  overflow: auto;
  width: 70%;
  background: #fff;
  border: 4px solid #eee;
  z-index: 888;
  border-radius: 12px;
  top: 10%;
  left: 50%;
  margin-left: -35%;
}
.Package label{
    width: 72px;
}
.Package .packageTop {
    font-size: 15px;
    text-indent: 15px;
    height: 30px;
    line-height: 30px;
    border-bottom: 1px solid #eee;
}
.SetMeal {
  min-height: 600px;
  padding: 0 10px;
  overflow: auto;
}
.InputList {
  display: flex;
  background: #ffffff;
  justify-content: space-between;
}
.InputList div {
    flex: 1;
    margin: 4px 0;
  }
.InputList div label {
    display: inline-block;
    width: 72px;
    text-align: left;
    margin-left: 5px;
}

.demo-upload-list {
  display: inline-block;
  width: 100px;
  height: 100px;
  text-align: center;
  line-height: 100px;
  border: 1px solid transparent;
  border-radius: 4px;
  overflow: hidden;
  background: #fff;
  position: relative;
  box-shadow: 0 1px 1px rgba(0, 0, 0, 0.2);
  margin-right: 4px;
}
.demo-upload-list img {
  width: 100%;
  height: 100%;
}
.demo-upload-list-cover {
  display: none;
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
  background: rgba(0, 0, 0, 0.6);
}
.demo-upload-list:hover .demo-upload-list-cover {
  display: block;
}
.demo-upload-list-cover i {
  color: #fff;
  font-size: 20px;
  cursor: pointer;
  margin: 0 10px;
}

.imglist {
  position: relative;
  display: inline-block;
  width: 100px;
}

.san_top {
  margin: 0 10px;
  text-indent: 10px;
  border-bottom: 1px solid #ccc;
  font-size: 16px;
  height: 40px;
  line-height: 40px;
  margin-bottom: 10px;
}
</style>
